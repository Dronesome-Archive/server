{% extends "_layout.html" %}
{% block main %}
    <div class="stretch window">
        <h1>Mitarbeiter</h1>
        <div class="flex_stack stretch">
            <div class="item multi">
                <p class="stretch">{{ me['name'] }}</p>
            </div>
            {% for member in members %}
                <div class="item multi">
                    <p class="stretch">{{ member['name'] }}</p>
                    {% if me['can_manage_users'] %}
                        <button onclick="show_popup('{{ member['name'] }}_edit')"><i class="fas fa-pen-alt"></i></button>
                        <button onclick="show_popup('{{ member['name'] }}_delete')"><i class="fas fa-trash-alt"></i></button>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        <div class="item multi">
            <p class="stretch">Neuer Mitarbeiter</p>
            <button onclick="show_popup('new')"><i class="fas fa-user-plus"></i></button>
        </div>
    </div>
{% endblock %}

{% block popup %}
    <div class="popup centered window" id="new">
            <h2>Neuer Mitarbeiter</h2>
            <form method="post" action="{{ url_for('users.new_key') }}">
                <div class="item multi">
                    <input class="item" type="checkbox" name="can_control_drone">
                    <label for="can_control_drone">Darf Drohne kontrollieren</label>
                </div>
                <div class="item multi">
                    <input class="item" type="checkbox" name="can_manage_users">
                    <label for="can_manage_users">Darf Nutzer verwalten</label>
                </div>
                <div class="flex_row">
                    <button class="item" type="reset" onclick="hide_popup('new')">Abbrechen</button>
                    <button class="item" type="submit">OK</button>
                </div>
            </form>
        </div>

    {% for member in members %}
        <div class="popup centered window" id="{{ member['name'] }}_edit">
            <h2>{{ member['name'] }}</h2>
            <form method="post" action="{{ url_for('users.edit', user_id=member['_id']) }}">
                <input type="text" name="name" value="{{ member['name'] }}">
                <div class="item multi">
                    <input class="item" type="checkbox" name="can_control_drone" {% if member['can_control_drone'] %}checked{% endif %}>
                    <label for="can_control_drone">Darf Drohne kontrollieren</label>
                </div>
                <div class="item multi">
                    <input class="item" type="checkbox" name="can_manage_users" {% if member['can_manage_users'] %}checked{% endif %}>
                    <label for="can_manage_users">Darf Nutzer verwalten</label>
                </div>
                <div class="flex_row">
                    <button class="item" type="reset" onclick="hide_popup('{{ member['name'] }}_edit')">Abbrechen</button>
                    <button class="item" type="submit">OK</button>
                </div>
            </form>
        </div>

        <div class="popup centered window" id="{{ member['name'] }}_delete">
            <p>Account von {{ member['name'] }} wirklich löschen?</p>
            <form method="post" action="{{ url_for('users.delete', user_id=member['_id']) }}">
                <div class="flex_row">
                    <button class="item" type="button" onclick="hide_popup('{{ member['name'] }}_edit')">Nein, abbrechen</button>
                    <button class="item" type="submit">Ja, löschen</button>
                </div>
            </form>
        </div>
    {% endfor %}
{% endblock %}